<!-- Isaac Start -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>FluffyFriend ‚Äî Products</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    /* Layout + base */
    html, body {
      height: 100%;
      margin: 0;
      display: flex;
      flex-direction: column;
      font-family: 'Segoe UI', sans-serif;
      background: radial-gradient(circle at top, #ffe4f4 0, #ffd6ef 25%, #ffedf7 60%, #ffeef8 100%);
    }
    main {
      flex: 1;
    }

    /* Shared navbar (partials/user_navbar) */

    .navbar {

      background: linear-gradient(90deg, #ff8db8, #ff6fa3);

    }

    .navbar-brand {

      color: #fff !important;

      font-weight: 700;

      font-size: 1.2rem;

      display: flex;

      align-items: center;

      gap: 8px;

    }

    .navbar .nav-link {

      color: #fff !important;

      font-weight: 500;

      border-radius: 8px;

      padding: 8px 14px;

      transition: 0.3s ease;

    }

    .navbar .nav-link:hover {

      background-color: rgba(255, 255, 255, 0.2);

      color: #fff !important;

    }

    .navbar .navbar-toggler {

      border-color: rgba(255, 255, 255, 0.6);

    }

    .navbar .navbar-toggler-icon {

      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba(255,255,255,.9)' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");

    }



    /* Legacy navbar styles (guests/admin) */

    .navbar-fluffy {

      background: linear-gradient(90deg,#ff8db8,#ff6fa3);

      padding: 10px 0;

    }

    .brand-icon {

      width:34px;

      height:34px;

      border-radius:50%;

      background:#fff;

      display:flex;

      align-items:center;

      justify-content:center;

      font-size:20px;

    }

    .nav-menu {

      color: #fff !important;

      font-weight: 500;

      padding: 6px 14px;

      border-radius: 8px;

      transition: 0.25s ease;

    }

    .nav-menu:hover {

      background: rgba(255, 255, 255, 0.2);

      color: #fff !important;

      text-decoration: none;

    }



    /* Flash messages */
    .flash-wrapper {
      max-width:900px;
      margin:16px auto 0;
    }

    /* Search bar */
    .search-bar-wrapper {
      max-width:900px;
      margin:8px auto 10px;
      display:flex;
      gap:8px;
      align-items:center;
    }
    .search-input {
      flex:1;
      border-radius:999px;
      border:none;
      padding:10px 18px;
      font-size:0.95rem;
      box-shadow:0 3px 8px rgba(0,0,0,.08);
      background:#fff;
    }
    .search-input:focus {
      outline:none;
      box-shadow:0 0 0 2px rgba(255,111,163,0.3);
    }
    .search-button {
      border:none;
      border-radius:999px;
      padding:10px 22px;
      background:#ff6fa3;
      color:#fff;
      font-weight:600;
      box-shadow:0 3px 8px rgba(0,0,0,.15);
      transition:0.2s ease;
    }
    .search-button:hover {
      background:#ff8db8;
    }

    /* Category filter pills */
    .filter-bar {
      max-width:900px;
      margin:6px auto 24px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .filter-pill {
      border-radius:999px;
      border:none;
      padding:6px 14px;
      font-size:0.85rem;
      background:#ffe0f0;
      color:#ff4c93;
      font-weight:500;
      cursor:pointer;
      transition:0.2s ease;
    }
    .filter-pill:hover {
      background:#ffd1eb;
    }
    .filter-pill.active {
      background:#ff6fa3;
      color:#fff;
    }

    /* Product grid + cards */
    .product-grid {
      max-width:1050px;
      margin:0 auto 40px;
    }
    .product-card {
      border-radius:18px;
      background:linear-gradient(180deg,#ffe6f3,#ffd9ef);
      border:none;
      padding:18px 18px 16px;
      box-shadow:0 5px 16px rgba(0,0,0,.08);
      height:100%;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }
    .product-card:hover {
      transform: translateY(-3px);
      box-shadow:0 8px 20px rgba(0,0,0,.12);
    }
    .paw-icon {
      width:70px;
      height:70px;
      border-radius:50%;
      background:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:36px;
      color:#ff6fa3;
      margin:12px auto;
    }
    .product-name {
      font-size:0.98rem;
      font-weight:700;
      margin-bottom:4px;
      text-align:center;
    }
    .product-desc {
      font-size:0.8rem;
      color:#7b6c80;
      margin-bottom:10px;
      min-height:32px;
      text-align:center;
    }
    .price-row {
      margin-top:8px;
      text-align:center;
    }
    .price {
      font-weight:700;
      color:#ff4c93;
      font-size:0.95rem;
    }

    /* Back button */
    .back-wrapper {
      max-width:900px;
      margin:0 auto 20px;
    }
    .btn-back {
      background:#ff6fa3;
      border:none;
      color:white;
      padding:10px 22px;
      border-radius:8px;
      font-weight:600;
      cursor:pointer;
      box-shadow:0 3px 8px rgba(0,0,0,0.15);
      transition:0.2s ease;
    }
    .btn-back:hover {
      background:#ff8db8;
    }

    /* Quantity input */
    .qty-input {
      width:70px;
      padding:6px;
      border-radius:10px;
      border:2px solid #ffaad1;
      font-size:0.9rem;
      text-align:center;
      font-weight:600;
      background:#fff;
      transition:0.25s ease;
    }
    .qty-input:focus {
      outline:none;
      border-color:#ff6fa3;
      box-shadow:0 0 6px rgba(255,111,163,0.4);
    }

    /* Shop buttons row */
    .btn-row {
      display:flex;
      justify-content:center;
      gap:8px;
      margin-top:8px;
    }
    .btn-shop {
      border:none;
      border-radius:999px;
      padding:8px 16px;
      font-size:0.85rem;
      font-weight:600;
      cursor:pointer;
      box-shadow:0 3px 8px rgba(0,0,0,0.18);
      transition:0.2s ease;
      color:#fff;
      white-space:nowrap;
    }
    .btn-add-cart {
      background:#ff6fa3;
    }
    .btn-add-cart:hover {
      background:#ff8db8;
    }
    .btn-buy-now {
      background:#ff4c93;
    }
    .btn-buy-now:hover {
      background:#ff6fa3;
    }
  </style>
</head>
<body>

  <!-- Navbar -->

  <% if (user && user.role === 'user') { %>

    <%- include('partials/user_navbar') %>

  <% } else { %>

    <nav class="navbar navbar-fluffy">

      <div class="container d-flex justify-content-between align-items-center">

        <!-- Logo -->

        <a class="navbar-brand" href="/">

          <div class="brand-icon">dY?_</div>

          <span>FluffyFriend</span>

        </a>



        <!-- Right-side buttons -->

        <div class="d-flex align-items-center gap-3">

          <ul class="navbar-nav ms-auto d-flex flex-row align-items-center">

            <% if (user) { %>

              <li class="nav-item mx-2">

                <a class="nav-link nav-menu d-flex align-items-center" href="/cart">

                  dY>' <span style="margin-left:6px;">Go To Cart</span>

                </a>

              </li>

            <% } else { %>

              <li class="nav-item mx-2">

                <a class="nav-link nav-menu" href="/login">Login</a>

              </li>

              <li class="nav-item mx-2">

                <a class="nav-link nav-menu" href="/register">Register</a>

              </li>

            <% } %>

          </ul>

        </div>

      </div>

    </nav>

  <% } %>



  <main>
    <%
      const selCategory = (typeof selectedCategory !== 'undefined' ? selectedCategory : '');
      const q = (typeof query !== 'undefined' ? query : '');
    %>

    <!-- Flash messages -->
    <div class="flash-wrapper">
      <% if (success && success.length) { %>
        <div class="alert alert-success py-2"><%= success[0] %></div>
      <% } %>
      <% if (error && error.length) { %>
        <div class="alert alert-danger py-2"><%= error[0] %></div>
      <% } %>
    </div>

    <!-- Search bar -->
    <div class="search-bar-wrapper">
      <form class="d-flex w-100" method="GET" action="/UserProducts">
        <input
          type="text"
          name="q"
          class="search-input"
          placeholder="Search food, toys, grooming..."
          value="<%= q %>"
        />
        <button class="search-button" type="submit">Search</button>
      </form>
    </div>

    <!-- Filter pills -->
    <div class="filter-bar">
      <!-- All -->
      <button
        type="button"
        class="filter-pill <%= !selCategory ? 'active' : '' %>"
        onclick="location.href='/UserProducts'">
        All
      </button>

      <!-- Food -->
      <button
        type="button"
        class="filter-pill <%= selCategory === 'Food' ? 'active' : '' %>"
        onclick="location.href='/UserProducts?category=Food'">
        Food
      </button>

      <!-- Toys -->
      <button
        type="button"
        class="filter-pill <%= selCategory === 'Toys' ? 'active' : '' %>"
        onclick="location.href='/UserProducts?category=Toys'">
        Toys
      </button>

      <!-- Grooming -->
      <button
        type="button"
        class="filter-pill <%= selCategory === 'Grooming' ? 'active' : '' %>"
        onclick="location.href='/UserProducts?category=Grooming'">
        Grooming
      </button>

      <!-- Healthcare -->
      <button
        type="button"
        class="filter-pill <%= selCategory === 'Healthcare' ? 'active' : '' %>"
        onclick="location.href='/UserProducts?category=Healthcare'">
        Healthcare
      </button>
    </div>

    <!-- Back button -->
    <div class="back-wrapper">
      <button class="btn-back" onclick="window.location.href='/'">
        ‚Üê Back
      </button>
    </div>

    <!-- Product cards -->
    <div class="product-grid container">
      <div class="row g-4">
        <% if (products && products.length) { %>
          <% products.forEach(function (p) { %>
            <div class="col-12 col-sm-6 col-md-4 col-lg-3">
              <div class="product-card">
                <!-- CLICKABLE image + name to viewproduct -->
                <a href="/viewproduct/<%= p.id %>" style="text-decoration:none; color:inherit;">
                  <% if (p.image) { %>
                    <div class="text-center">
                      <img
                        src="/images/products/<%= p.image %>"
                        alt="<%= p.productName %>"
                        class="img-fluid rounded-3 mb-2"
                        style="max-height:160px; object-fit:cover;"
                      >
                    </div>
                  <% } else { %>
                    <div class="paw-icon">üêæ</div>
                  <% } %>

                  <div class="product-name"><%= p.productName %></div>
                </a>

                <!-- DESC -->
                <div class="product-desc">
                  <%= p.description ? p.description : (p.category || '') %>
                </div>

                <!-- PRICE + Quantity -->
                <div class="price-row">
                  <span class="price">$<%= Number(p.price).toFixed(2) %></span>
                  <div class="text-muted small mt-1">
                    In stock: <strong><%= p.quantity %></strong>
                  </div>
                </div>

                <!-- QUANTITY SELECTOR + ADD TO CART -->
                <div class="text-center mt-2">
                  <form
                    action="/UserProducts/add/<%= p.id %>"
                    method="POST"
                    class="d-flex justify-content-center align-items-center gap-2"
                  >
                    <input
                      type="number"
                      name="quantity"
                      min="1"
                      max="<%= p.quantity %>"
                      value="1"
                      class="qty-input"
                    />

                    <button type="submit" class="btn-shop btn-add-cart">
                      Add to Cart
                    </button>
                  </form>
                </div>

                <!-- BUY NOW (default quantity 1) -->
                <form action="/add-to-cart/<%= p.id %>" method="POST" class="text-center mt-2">
                  <input type="hidden" name="quantity" value="1">
                  <button
                    type="submit"
                    class="btn-shop btn-buy-now"
                    <%= p.quantity < 1 ? 'disabled' : '' %>>
                    Buy Now
                  </button>
                </form>
              </div>
            </div>
          <% }); %>
        <% } else { %>
          <div class="col-12 text-center py-5">
            <p>No products found.</p>
          </div>
        <% } %>
      </div>
    </div>
  </main>

  <%- include('partials/footer') %>
</body>
</html>
<!-- Isaac End -->
