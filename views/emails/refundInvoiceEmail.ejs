<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Refund Invoice</title>
</head>
<body style="margin:0; padding:0; background:#fff1f6; font-family:'Segoe UI', Arial, sans-serif; color:#1f2937;">
  <table width="100%" cellpadding="0" cellspacing="0" style="background:#fff1f6; padding:36px 12px;">
    <tr>
      <td align="center">
        <table width="640" cellpadding="0" cellspacing="0" style="background:#ffffff; border-radius:20px; box-shadow:0 18px 45px rgba(190,24,93,.18); overflow:hidden;">
          <tr>
            <td style="padding:0;">
              <table width="100%" cellpadding="0" cellspacing="0">
                <tr>
                  <td style="background:linear-gradient(135deg,#f472b6,#fb7185,#f9a8d4); padding:26px 28px; color:#ffffff;">
                    <div style="text-transform:uppercase; font-size:11px; letter-spacing:2px; color:rgba(255,255,255,.85);">Supermarket App</div>
                    <h1 style="margin:8px 0 6px; font-size:22px; line-height:1.2;">Refund processed</h1>
                    <div style="font-size:13px;">Invoice <strong><%= refund.invoiceNumber || '-' %></strong></div>
                  </td>
                  <td align="right" style="background:linear-gradient(135deg,#f472b6,#fb7185,#f9a8d4); padding:26px 28px; color:#ffffff;">
                    <div style="font-size:11px; text-transform:uppercase; letter-spacing:1px; color:rgba(255,255,255,.85);">Refund Date</div>
                    <div style="font-size:14px; font-weight:600;"><%= refund.createdAt ? new Date(refund.createdAt).toLocaleString() : '-' %></div>
                  </td>
                </tr>
              </table>
            </td>
          </tr>

          <tr>
            <td style="padding:18px 28px 0;">
              <table width="100%" cellpadding="0" cellspacing="0">
                <tr>
                  <td style="background:#fff5f8; border:1px solid #fbcfe8; border-radius:14px; padding:14px 16px;">
                    <div style="font-size:11px; color:#be185d; text-transform:uppercase; letter-spacing:1px;">Refund Amount</div>
                    <div style="font-size:16px; font-weight:600; color:#111827;">$<%= Number(refund.amount || 0).toFixed(2) %> <%= refund.currency || '' %></div>
                  </td>
                  <td width="12"></td>
                  <td style="background:#fff5f8; border:1px solid #fbcfe8; border-radius:14px; padding:14px 16px;">
                    <div style="font-size:11px; color:#be185d; text-transform:uppercase; letter-spacing:1px;">Status</div>
                    <div style="font-size:16px; font-weight:600; color:#111827;"><%= refund.status || 'UNKNOWN' %></div>
                  </td>
                </tr>
              </table>
            </td>
          </tr>

          <tr>
            <td style="padding:18px 28px 4px;">
              <div style="background:#fff5f8; border:1px solid #fbcfe8; border-radius:14px; padding:12px 16px;">
                <div style="font-size:11px; color:#be185d; text-transform:uppercase; letter-spacing:1px;">Refund Reason</div>
                <div style="font-size:14px; margin-top:6px; color:#1f2937;"><%= refund.refundReason || '-' %></div>
              </div>
            </td>
          </tr>

          <tr>
            <td style="padding:18px 28px 8px;">
              <h3 style="margin:0 0 12px; font-size:16px; color:#111827;">Refund Items</h3>
              <% if (refundItems && refundItems.length) { %>
                <table width="100%" cellpadding="0" cellspacing="0" style="font-size:13px; border-collapse:collapse;">
                  <thead>
                    <tr style="text-transform:uppercase; font-size:11px; color:#9f1239;">
                      <th align="left" style="padding:10px 0; border-bottom:1px solid #fbcfe8;">Item</th>
                      <th align="right" style="padding:10px 0; border-bottom:1px solid #fbcfe8;">Unit Price</th>
                      <th align="right" style="padding:10px 0; border-bottom:1px solid #fbcfe8;">Qty</th>
                      <th align="right" style="padding:10px 0; border-bottom:1px solid #fbcfe8;">Line Total</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% refundItems.forEach(function(item){ 
                         const qty = Number(item.quantity || 0);
                         const unitPrice = Number(item.unitPrice || 0);
                         const lineTotal = qty * unitPrice;
                    %>
                      <tr>
                        <td style="padding:10px 0; border-bottom:1px solid #fdf2f8;"><%= item.productName || ('Product #' + item.productId) %></td>
                        <td style="padding:10px 0; text-align:right; border-bottom:1px solid #fdf2f8;">$<%= unitPrice.toFixed(2) %></td>
                        <td style="padding:10px 0; text-align:right; border-bottom:1px solid #fdf2f8;"><%= qty %></td>
                        <td style="padding:10px 0; text-align:right; border-bottom:1px solid #fdf2f8;">$<%= lineTotal.toFixed(2) %></td>
                      </tr>
                    <% }) %>
                  </tbody>
                </table>
              <% } else { %>
                <div style="color:#6b7280; font-size:13px;">No refund items recorded.</div>
              <% } %>
            </td>
          </tr>

          <tr>
            <td style="padding:8px 28px 26px;">
              <table width="100%" cellpadding="0" cellspacing="0" style="font-size:14px;">
                <tr>
                  <td style="padding:6px 0; color:#6b7280;">Payment Method</td>
                  <td style="padding:6px 0; text-align:right;"><%= refund.paymentMethod || 'Unknown' %></td>
                </tr>
                <tr>
                  <td style="padding:6px 0; color:#6b7280;">Order Total</td>
                  <td style="padding:6px 0; text-align:right;">$<%= Number(orderTotal || 0).toFixed(2) %></td>
                </tr>
                <tr>
                  <td style="padding:6px 0; color:#6b7280;">Refunded Total (to date)</td>
                  <td style="padding:6px 0; text-align:right;">$<%= Number(refundedToDate || 0).toFixed(2) %></td>
                </tr>
                <tr>
                  <td style="padding:10px 0; color:#111827; font-weight:600; border-top:1px solid #fbcfe8;">Remaining Balance</td>
                  <td style="padding:10px 0; text-align:right; font-weight:600; border-top:1px solid #fbcfe8;">$<%= Number(remaining || 0).toFixed(2) %></td>
                </tr>
              </table>
            </td>
          </tr>

          <tr>
            <td style="padding:16px 28px 24px; background:#fff5f8; color:#6b7280; font-size:12px;">
              This is an automated refund invoice from Supermarket App.
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
</body>
</html>
