<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Refunds - Supermarket App</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: linear-gradient(180deg, #f6fbff 0%, #edf3ff 45%, #f5f7fb 100%);
      font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }
    main { flex: 1 0 auto; }
    .navbar {
      background: linear-gradient(90deg, #ff8db8, #ff6fa3);
    }
    .navbar-brand, .nav-link {
      color: white !important;
      font-weight: 500;
    }
    .nav-link:hover {
      background-color: #ff8db8;
      border-radius: 6px;
    }
    .page-card {
      background: #fff;
      border-radius: 22px;
      box-shadow: 0 20px 45px rgba(15,23,42,.12), 0 3px 10px rgba(15,23,42,.08);
    }
    .hero-intro {
      background: linear-gradient(135deg, #f2f7ff 0%, #fff5ea 55%, #f3f8ff 100%);
      border-radius: 22px;
      padding: 1.5rem 2rem;
      border: 1px solid rgba(255, 181, 90, .2);
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
      position: relative;
      overflow: hidden;
    }
    .hero-intro::after {
      content: "";
      position: absolute;
      width: 180px;
      height: 180px;
      background: radial-gradient(circle at top right, rgba(255, 168, 102, .35), transparent 70%);
      top: -80px;
      right: -60px;
      border-radius: 50%;
    }
    .hero-icon {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: linear-gradient(135deg, #f59e0b, #fbbf24);
      color: #fff;
      font-size: 1.6rem;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 12px 25px rgba(245, 158, 11, .35);
    }
    .hero-text h2 { margin-bottom: .4rem; font-weight: 700; color: #101828; }
    .hero-text p { margin: 0; color: #475467; }
    .hero-badge {
      background: rgba(245, 158, 11, .15);
      color: #b45309;
      padding: .25rem .85rem;
      border-radius: 999px;
      font-size: .8rem;
      text-transform: uppercase;
      letter-spacing: .08em;
    }
    .refund-filters {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      margin: 0 0 12px;
    }
    .refund-search {
      max-width: 260px;
    }
    .filter-chip {
      border: 1px solid rgba(255, 111, 163, 0.35);
      background: #fff;
      color: #a66384;
      border-radius: 999px;
      padding: 6px 14px;
      font-size: 0.85rem;
      font-weight: 600;
      transition: all 0.2s ease;
    }
    .filter-chip.active,
    .filter-chip:hover {
      background: #ff6fa3;
      color: #fff;
      border-color: #ff6fa3;
      box-shadow: 0 8px 16px rgba(255, 111, 163, 0.25);
    }
  </style>
</head>
<body>
  <%- include('partials/user_navbar', { active: 'refunds' }) %>

  <main class="my-4">
    <div class="container">
      <div class="page-card p-4">
        <div class="hero-intro">
          <div class="hero-icon" aria-hidden="true">â†»</div>
          <div class="hero-text">
            <h2 class="mb-1">Your Refund History</h2>
            <p>Track refund amounts and access your invoice history.</p>
          </div>
          <span class="hero-badge">Refunds</span>
        </div>

        <% if (!refunds.length) { %>
          <p>You do not have any refunds yet.</p>
          <a href="/orders" class="btn btn-primary">View Orders</a>
        <% } else { %>
          <div class="d-flex justify-content-between flex-wrap gap-2 mb-3">
            <div class="refund-filters" id="refundFilters">
              <input
                type="text"
                class="form-control refund-search"
                placeholder="Search invoice number"
                aria-label="Search invoice number"
                data-refund-search
              >
            </div>
            <div class="text-muted small align-self-center">
              <%= refunds.length %> refund<%= refunds.length === 1 ? '' : 's' %>
            </div>
          </div>

          <div class="table-responsive mt-2">
            <table class="table table-bordered align-middle text-center" id="refundsTable">
              <thead class="table-light">
                <tr>
                  <th>#</th>
                  <th>Invoice Number</th>
                  <th>Refund Date</th>
                  <th>Refund Amount</th>
                  <th>Status</th>
                  <th>Invoice</th>
                </tr>
              </thead>
              <tbody>
                <% refunds.forEach(function(refund, index) { %>
                  <tr data-invoice="<%= String(refund.invoiceNumber || '').toLowerCase() %>"
                      data-status="<%= String(refund.status || 'UNKNOWN').toUpperCase() %>">
                    <td><%= index + 1 %></td>
                    <td class="fw-semibold"><%= refund.invoiceNumber %></td>
                    <td><%= refund.createdAt ? new Date(refund.createdAt).toLocaleString() : '-' %></td>
                    <td>$<%= Number(refund.amount || 0).toFixed(2) %> <%= refund.currency || '' %></td>
                    <td>
                      <span class="badge bg-light text-dark border">
                        <%= refund.status || 'UNKNOWN' %>
                      </span>
                    </td>
                    <td>
                      <a href="/refunds/<%= refund.id %>" class="btn btn-sm btn-outline-primary">Invoice</a>
                    </td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        <% } %>
      </div>
    </div>
  </main>

  <style>
    html { scroll-behavior: smooth; }
    footer { flex-shrink: 0; margin-top: auto; }

    .app-footer { background-color: #0b2131; color: #e6edf3; }
    .app-footer a { color: #e6edf3; text-decoration: none; }
    .app-footer a:hover { text-decoration: underline; }
    .app-footer-gradient {
      height: 4px;
      background: linear-gradient(
        90deg,
        var(--bs-primary, #0d6efd),
        var(--bs-info, #0dcaf0),
        var(--bs-success, #198754),
        var(--bs-warning, #ffc107),
        var(--bs-danger, #dc3545)
      );
    }
    .app-footer-inner { font-size: .95rem; }
  </style>

  <%- include('partials/footer') %>
  <script>
    (function () {
      const filters = document.getElementById('refundFilters');
      const table = document.getElementById('refundsTable');
      if (!filters || !table) return;

      const rows = Array.from(table.querySelectorAll('tbody tr'));
      const searchInput = filters.querySelector('[data-refund-search]');
      function applyFilters() {
        const query = (searchInput.value || '').trim().toLowerCase();

        rows.forEach((row) => {
          const matchesInvoice = !query || (row.dataset.invoice || '').includes(query);
          row.style.display = matchesInvoice ? '' : 'none';
        });
      }

      if (searchInput) {
        searchInput.addEventListener('input', applyFilters);
      }
    })();
  </script>
</body>
</html>
